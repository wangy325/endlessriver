<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Redis Sentinelé«˜å¯ç”¨å®ç° - Endless River</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="wangy325" /><meta name="description" content="Redis v2.8 ä¹‹åæä¾›äº†é«˜å¯ç”¨å®ç°Redis Sentinelï¼Œå®ç°äº†ä¸»ä»å¤åˆ¶ä»¥åŠè¢«åŠ¨ä¸»å¤‡åˆ‡æ¢ã€‚v3.0 ä¹‹åæä¾›äº†åˆ†å¸ƒå¼å®ç°Redis Clusterã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯ä½¿ç”¨Sentinelæ­å»ºRedisé«˜å¯ç”¨æœåŠ¡ã€‚
 If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1.
 1 å‡†å¤‡ 1.1 linuxä¸»æœº æœ¬æ–‡ä½¿ç”¨centOS7ï¼Œéœ€å®‰è£…gccï¼š
1 2 3  yum install gcc # or on ubuntu apt-get install gcc  " />






<meta name="generator" content="Hugo 0.55.6 with even 4.0.0" />


<link rel="canonical" href="https://wangy325.top/post/tech/java/build-redis-sentinel/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.f64a7681.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Redis Sentinelé«˜å¯ç”¨å®ç°" />
<meta property="og:description" content="Redis v2.8 ä¹‹åæä¾›äº†é«˜å¯ç”¨å®ç°Redis Sentinelï¼Œå®ç°äº†ä¸»ä»å¤åˆ¶ä»¥åŠè¢«åŠ¨ä¸»å¤‡åˆ‡æ¢ã€‚v3.0 ä¹‹åæä¾›äº†åˆ†å¸ƒå¼å®ç°Redis Clusterã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯ä½¿ç”¨Sentinelæ­å»ºRedisé«˜å¯ç”¨æœåŠ¡ã€‚


If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1.


1 å‡†å¤‡

1.1 linuxä¸»æœº

æœ¬æ–‡ä½¿ç”¨centOS7ï¼Œéœ€å®‰è£…gccï¼š


1
2
3


yum install gcc
# or on ubuntu
apt-get install gcc

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wangy325.top/post/tech/java/build-redis-sentinel/" />
<meta property="article:published_time" content="2019-08-14T16:01:23&#43;08:00"/>
<meta property="article:modified_time" content="2020-11-20T23:47:30&#43;08:00"/>

<meta itemprop="name" content="Redis Sentinelé«˜å¯ç”¨å®ç°">
<meta itemprop="description" content="Redis v2.8 ä¹‹åæä¾›äº†é«˜å¯ç”¨å®ç°Redis Sentinelï¼Œå®ç°äº†ä¸»ä»å¤åˆ¶ä»¥åŠè¢«åŠ¨ä¸»å¤‡åˆ‡æ¢ã€‚v3.0 ä¹‹åæä¾›äº†åˆ†å¸ƒå¼å®ç°Redis Clusterã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯ä½¿ç”¨Sentinelæ­å»ºRedisé«˜å¯ç”¨æœåŠ¡ã€‚


If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1.


1 å‡†å¤‡

1.1 linuxä¸»æœº

æœ¬æ–‡ä½¿ç”¨centOS7ï¼Œéœ€å®‰è£…gccï¼š


1
2
3


yum install gcc
# or on ubuntu
apt-get install gcc

">


<meta itemprop="datePublished" content="2019-08-14T16:01:23&#43;08:00" />
<meta itemprop="dateModified" content="2020-11-20T23:47:30&#43;08:00" />
<meta itemprop="wordCount" content="7615">



<meta itemprop="keywords" content="redis," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis Sentinelé«˜å¯ç”¨å®ç°"/>
<meta name="twitter:description" content="Redis v2.8 ä¹‹åæä¾›äº†é«˜å¯ç”¨å®ç°Redis Sentinelï¼Œå®ç°äº†ä¸»ä»å¤åˆ¶ä»¥åŠè¢«åŠ¨ä¸»å¤‡åˆ‡æ¢ã€‚v3.0 ä¹‹åæä¾›äº†åˆ†å¸ƒå¼å®ç°Redis Clusterã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯ä½¿ç”¨Sentinelæ­å»ºRedisé«˜å¯ç”¨æœåŠ¡ã€‚


If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1.


1 å‡†å¤‡

1.1 linuxä¸»æœº

æœ¬æ–‡ä½¿ç”¨centOS7ï¼Œéœ€å®‰è£…gccï¼š


1
2
3


yum install gcc
# or on ubuntu
apt-get install gcc

"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Endless River</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">ä¸»é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äº</li>
      </a><a href="/friendlink/">
        <li class="mobile-menu-item">å‹é“¾</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Endless River</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">ä¸»é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">å…³äº</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/friendlink/">å‹é“¾</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Redis Sentinelé«˜å¯ç”¨å®ç°</h1>

      <div class="post-meta">
          <span>
              <span class="icomoonfree icon-calendar"></span>
              <span class="post-time"> 2019-08-14</span>
          </span>

        <div class="post-category">
              <span class="icomoonfree icon-folder"></span>
            <a href="/categories/nosql/"> NOSQL </a>
            </div>
          <span class="icomoonfree icon-sigma"></span>
          <span class="more-meta analyse"> çº¦ 7615 å­— </span>
          <span class="icomoonfree icon-clock"></span>
          <span class="more-meta analyse"> é¢„è®¡é˜…è¯» 16 åˆ†é’Ÿ </span>
        <span class="icomoonfree icon-eye"></span>
          <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> æ¬¡é˜…è¯» </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-å‡†å¤‡">1 å‡†å¤‡</a>
<ul>
<li><a href="#1-1-linuxä¸»æœº">1.1 linuxä¸»æœº</a></li>
<li><a href="#1-2-redis-æºç ">1.2 Redis æºç </a></li>
<li><a href="#1-3-äº†è§£linuxé˜²ç«å¢™çš„åŸºæœ¬çŸ¥è¯†">1.3 äº†è§£linuxé˜²ç«å¢™çš„åŸºæœ¬çŸ¥è¯†</a></li>
<li><a href="#1-4-master-slaveå’Œsentinel">1.4 masterï¼Œslaveå’Œsentinel</a></li>
</ul></li>
<li><a href="#2-å®‰è£…é…ç½®redis">2 å®‰è£…é…ç½®Redis</a>
<ul>
<li><a href="#section-1">2.1 ç¼–è¯‘æºç </a></li>
<li><a href="#2-2-å…¶ä»–é…ç½®é¡¹">2.2 å…¶ä»–é…ç½®é¡¹</a></li>
<li><a href="#2-3-é…ç½®æ–‡ä»¶redis-conf">2.3 é…ç½®æ–‡ä»¶redis.conf</a></li>
</ul></li>
<li><a href="#3-å¯åŠ¨redis">3 å¯åŠ¨redis</a></li>
<li><a href="#4-ä½¿ç”¨redis-cli">4 ä½¿ç”¨redis-cli</a></li>
<li><a href="#5-å…³é—­redis-server">5 å…³é—­redis-server</a></li>
<li><a href="#6-è‰ºæœ¯å°±æ˜¯å¤åˆ¶">6 è‰ºæœ¯å°±æ˜¯å¤åˆ¶</a>
<ul>
<li><a href="#6-1-é…ç½®redis-salve">6.1 é…ç½®redis-salve</a>
<ul>
<li><a href="#6-1-1-salveå¯åŠ¨æ—¥å¿—">6.1.1 salveå¯åŠ¨æ—¥å¿—</a></li>
<li><a href="#6-1-2-éªŒè¯ä¸»ä»æ•°æ®åŒæ­¥">6.1.2 éªŒè¯ä¸»ä»æ•°æ®åŒæ­¥</a></li>
</ul></li>
<li><a href="#6-2-é…ç½®redis-sentinel">6.2 é…ç½®redis-sentinel</a>
<ul>
<li><a href="#6-2-1-sentinelå¯åŠ¨æ—¥å¿—">6.2.1 sentinelå¯åŠ¨æ—¥å¿—</a></li>
<li><a href="#6-2-2-ä½¿ç”¨redis-cliæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯">6.2.2 ä½¿ç”¨redis-cliæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</a></li>
<li><a href="#6-2-3-æ¨¡æ‹Ÿä¸»å¤‡åˆ‡æ¢">6.2.3 æ¨¡æ‹Ÿä¸»å¤‡åˆ‡æ¢</a></li>
</ul></li>
</ul></li>
<li><a href="#7-ç»“æŸè¯­">7 ç»“æŸè¯­</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>Redis <a href="https://raw.githubusercontent.com/antirez/redis/2.8/00-RELEASENOTES">v2.8</a> ä¹‹åæä¾›äº†é«˜å¯ç”¨å®ç°<code>Redis Sentinel</code>ï¼Œå®ç°äº†<strong>ä¸»ä»å¤åˆ¶</strong>ä»¥åŠ<del>è¢«åŠ¨</del><strong>ä¸»å¤‡åˆ‡æ¢</strong>ã€‚<a href="https://raw.githubusercontent.com/antirez/redis/3.0/00-RELEASENOTES">v3.0</a> ä¹‹åæä¾›äº†åˆ†å¸ƒå¼å®ç°<code>Redis Cluster</code>ã€‚æœ¬æ–‡è®¨è®ºçš„æ˜¯ä½¿ç”¨Sentinelæ­å»ºRedisé«˜å¯ç”¨æœåŠ¡ã€‚</p>

<blockquote>
<p>If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel <em>High-Availability</em> environment<sup class="footnote-ref" id="fnref:v1"><a href="#fn:v1">1</a></sup>.</p>
</blockquote>

<h1 id="1-å‡†å¤‡">1 å‡†å¤‡</h1>

<h2 id="1-1-linuxä¸»æœº">1.1 linuxä¸»æœº</h2>

<p>æœ¬æ–‡ä½¿ç”¨centOS7ï¼Œéœ€å®‰è£…gccï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">yum install gcc
<span class="c1"># or on ubuntu</span>
apt-get install gcc</code></pre></td></tr></table>
</div>
</div>
<h2 id="1-2-redis-æºç ">1.2 Redis æºç </h2>

<p>æœ¬æ–‡ä½¿ç”¨<a href="http://download.redis.io/releases/redis-4.0.11.tar.gz">v4.0.0.11</a>ï¼Œç‰ˆæœ¬å·åº”å¤§äº2.8.0ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥è·å–æŒ‡å®šç‰ˆæœ¬çš„redisï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">wget http://download.redis.io/releases/redis-4.0.11.tar.gz</code></pre></td></tr></table>
</div>
</div>
<h2 id="1-3-äº†è§£linuxé˜²ç«å¢™çš„åŸºæœ¬çŸ¥è¯†">1.3 äº†è§£linuxé˜²ç«å¢™çš„åŸºæœ¬çŸ¥è¯†</h2>

<p>centOS7å’ŒcentOS6ä½¿ç”¨ä¸åŒçš„é˜²ç«å¢™æœºåˆ¶ï¼Œå‰è€…ä½¿ç”¨<code>firewall</code>ï¼Œåè€…ä½¿ç”¨<code>iptables</code>ã€‚</p>

<h2 id="1-4-master-slaveå’Œsentinel">1.4 masterï¼Œslaveå’Œsentinel</h2>

<p>å¦‚æœåªæƒ³æ­å»ºä¸€ä¸ªå•æœº(standalone)å®ä¾‹<sup class="footnote-ref" id="fnref:v2"><a href="#fn:v2">2</a></sup>æ¥å­¦ä¹ redisçš„æ•°æ®ç»“æ„ï¼Œåªéœ€è¦é˜…è¯»å®‰è£…rediså®ä¾‹å°±å¥½ã€‚</p>

<p>å¤šä¸ª<code>standalone</code>åŠ ä¹‹åˆé€‚çš„é…ç½®ä¾¿ç»„æˆäº†<code>master-slave</code>ç»“æ„ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæ­¤æ—¶å·²ç»å…·å¤‡äº†ã€Œä¸»ä»å¤åˆ¶ã€çš„èƒ½åŠ›ã€‚</p>

<p>æ‰€è°“<code>Sentinel</code>ï¼Œå¹¶ä¸æ˜¯æ‰€è°“ã€Œæ–°æŠ€æœ¯ã€åè¯ï¼Œåªæ˜¯ä¸€ä¸ªç”¨æ¥åšç‰¹å®šäº‹æƒ…<sup class="footnote-ref" id="fnref:v3"><a href="#fn:v3">3</a></sup>çš„rediså®ä¾‹è€Œå·²ï¼Œæ•…æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç§°ä½œã€ŒæœåŠ¡ã€ã€‚å¦‚æœéœ€è¦æ­å»º<code>Sentinel</code>æœåŠ¡ï¼Œä½ éœ€è¦å…ˆå…·å¤‡<code>master-slave</code>ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ è‡³å°‘éœ€è¦æ­å»º2ä¸ªrediså®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶ä¸­ä¸€å°é…ç½®ä¸ºå¦ä¸€å°çš„slaveã€‚</p>

<p>äº†è§£æ›´å¤šå…³äºredis-sentinelçš„ç›¸å…³å†…å®¹ï¼Œè¯·å‚è€ƒ<a href="#">rediså“¨å…µä¸é«˜å¯ç”¨æ¶æ„</a>ã€‚</p>

<figure class="center">
    <img src="/img/master-slave-vs-sentinel.png"
         alt="img"/> <figcaption>
            <h4>redisçš„ä¸»ä»æ¨¡å¼å’Œå“¨å…µæ¨¡å¼</h4>
        </figcaption>
</figure>

<!-- <div class="admonition bug"><p class="admonition-title">bug</p>
  
æ­¤å¤„ç”¨å›¾ç‰‡é‡Šä¹‰å¯èƒ½æ›´æ˜ç¡®

</div> -->

<h1 id="2-å®‰è£…é…ç½®redis">2 å®‰è£…é…ç½®Redis</h1>

<p>æ¥ä¸‹æ¥ä¼šä¾æ¬¡å®‰è£…Rediså¹¶ä¸”é…ç½®å¤šä¸ªRediså®ä¾‹</p>

<h2 id="section-1">2.1 ç¼–è¯‘æºç </h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">  tar -zxf redis-4.0.11.tar.gz
  <span class="c1"># compile source code</span>
  <span class="nb">cd</span> redis-4.0.11
  <span class="c1"># redis was recommended to install in /usr/local/redis</span>
  mkdir /usr/local/redis
  make install <span class="nv">PREFIX</span><span class="o">=</span>/usr/local/redis
  <span class="c1"># ---</span>
  <span class="c1">#if all operations are right, you will see the output below:</span>
  <span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># cd /usr/local/redis ; ll</span>
  total <span class="m">68</span>
  drwxr-xr-x <span class="m">2</span> root root  <span class="m">4096</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 bin         <span class="c1">#the redis executable binary file folder.</span>
  -rw-r--r-- <span class="m">1</span> root root    <span class="m">93</span> Aug  <span class="m">4</span> <span class="m">16</span>:54 dump.rdb    <span class="c1">#the dump of redis database, You can config where to save it later.</span>
  -rw-r--r-- <span class="m">1</span> root root <span class="m">58905</span> Aug  <span class="m">7</span> <span class="m">13</span>:56 redis.conf  <span class="c1">#the config file of a particular redis instance.</span>
  <span class="o">[</span>root@shell redis<span class="o">]</span><span class="c1"># cd /usr/local/redis/bin ; ll</span>    
  total <span class="m">21876</span>
  -rwxr-xr-x <span class="m">1</span> root root <span class="m">2452168</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-benchmark                 <span class="c1">#redis test tool</span>
  -rwxr-xr-x <span class="m">1</span> root root <span class="m">5775312</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-check-aof                 <span class="c1">#redis AOF persistent check tool</span>
  -rwxr-xr-x <span class="m">1</span> root root <span class="m">5775312</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-check-rdb                 <span class="c1">#redis RBD persistent check tool</span>
  -rwxr-xr-x <span class="m">2</span> root root <span class="m">2618192</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-cli                       <span class="c1">#launch a redis client</span>
  lrwxrwxrwx <span class="m">1</span> root root      <span class="m">12</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-sentinel -&gt; redis-server  <span class="c1">#launch a redis sentinel server</span>
  -rwxr-xr-x <span class="m">3</span> root root <span class="m">5775312</span> Aug  <span class="m">4</span> <span class="m">15</span>:19 redis-server                    <span class="c1">#launch a redis server(instance)</span></code></pre></td></tr></table>
</div>
</div>
<p>ä¸¤ä¸ª<code>ll</code>å‘½ä»¤æ˜¾ç¤ºäº†ä¸€ä¸ªredisçš„å…¨éƒ¨å†…å®¹ã€‚æœ¬æ–‡ç”¨åˆ°çš„å‡ ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯ï¼š</p>

<ul>
<li>redis.confï¼š é…ç½®æ–‡ä»¶ï¼Œç»å¯¹çš„ä¸»è§’ï¼Œå®ƒçš„æˆè°éƒ½æŠ¢ä¸èµ°</li>
<li>redis-serverï¼š ğŸ§¹æ‰«åœ°åƒ§ï¼Œå¼€å±€ç°èº«ä¸€æ¬¡ï¼Œä¸å‡ºæ„å¤–å°†éšå±…</li>
<li>redis-clientï¼šè°éƒ½ä¸ç”¨clientï¼Œè°éƒ½æ˜¯client</li>
</ul>

<h2 id="2-2-å…¶ä»–é…ç½®é¡¹">2.2 å…¶ä»–é…ç½®é¡¹</h2>

<p>å¦‚æœä¸Šè¿°æ“ä½œæ²¡æœ‰é—®é¢˜<del>è¿™ä¹ˆç®€å•ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</del>ï¼Œç†è®ºä¸Šï¼Œä¸€ä¸ª<code>standalone</code>å®ä¾‹å·²ç»å®‰è£…å®Œæˆäº†ï¼Œå¯ä»¥é€šè¿‡ã€Œå‘½ä»¤ é…ç½®æ–‡ä»¶ã€çš„æ–¹å¼å¯åŠ¨redisæœåŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf</code></pre></td></tr></table>
</div>
</div>
<p>ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿å¯åŠ¨æœåŠ¡ï¼Œè¿˜éœ€è¦åšä¸€äº›é¢å¤–çš„æ“ä½œï¼š</p>

<p style="background-color:lightgray">å¤åˆ¶redisäºŒè¿›åˆ¶ç¨‹åºåˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡å¹¶å°†redisè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> /usr/local/redis/bin/
cp redis-server redis-cli redis-sentinel /usr/local/bin</code></pre></td></tr></table>
</div>
</div>
<p>å¦‚æ­¤ï¼Œå¯åŠ¨redisçš„æ—¶å€™ä¾¿ä¸éœ€è¦æŒ‡å®šç¨‹åºè·¯å¾„; æ­¤æ—¶ï¼Œå·²ç»å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œ<code>redis-server</code>äº†</p>

<p>å°†redisè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼ˆå¯é€‰æ“ä½œï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># å®‰è£…å®Œæˆåå¯ä»¥æ·»åŠ å¤šä¸ªå‘½ä»¤å¯åŠ¨redisä¸»ä»-å“¨å…µç³»ç»Ÿ</span>
<span class="nb">echo</span> <span class="s2">&#34;redis-server /usr/local/redis.conf&#34;</span> &gt;&gt; /etc/rc.local</code></pre></td></tr></table>
</div>
</div>
<!-- <p style="background-color:lightgray">å°†redisæ·»åŠ è‡³ç³»ç»ŸæœåŠ¡ï¼Œç®€åŒ–æœåŠ¡å¯åœæ“ä½œ</p>

<div class="admonition question"><p class="admonition-title">question</p>
  æ­¤å¤„éœ€è¦æ·»åŠ å†…å®¹
</div> -->

<p style="background-color:lightgray">å¼€æ”¾é˜²ç«å¢™ç«¯å£</p>

<div class="admonition tip"><p class="admonition-title">tip</p>
  è‹¥ä¸»æœºæœªå¼€å¯é˜²ç«å¢™ï¼Œåˆ™æ— éœ€æ“ä½œã€‚
</div>

<p>å¦‚æœä½ çš„ä¸»æœºå¼€å¯äº†é˜²ç«å¢™ï¼Œå…¶ä»–ä¸»æœºæ˜¯æ— æ³•è¿æ¥ä¸Šä½ çš„redis-serverçš„ï¼Œæ­¤æ—¶éœ€è¦ä¸ºå…¶å¼€æ”¾ç«¯å£ã€‚</p>

<p>å‰é¢è¯´åˆ°ï¼ŒcentOS7å’ŒcentOS6çš„é˜²ç«å¢™æœºåˆ¶ä¸ä¸€æ ·ï¼Œéœ€è¦åˆ†åˆ«å¤„ç†ã€‚</p>

<p>è‹¥éœ€çŸ¥æ™“é˜²ç«å¢™çŠ¶æ€ï¼Œè¯·è¿è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">systemctl status serviceName</code></pre></td></tr></table>
</div>
</div>
<p>centOS7 å’ŒcentOS6çš„é˜²ç«å¢™æœåŠ¡ååˆ†åˆ«ä¸º <code>firewalld</code>å’Œ<code>iptables</code></p>

<ul>
<li>å¯¹äºcentOS7ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># æŸ¥çœ‹å¼€æ”¾ç«¯å£</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># firewall-cmd --list-all</span>
public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: ssh dhcpv6-client http
  ports: <span class="m">6379</span>/tcp
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
<span class="c1"># å¦‚æœ6379ç«¯å£ä¸åœ¨è¿”å›ç»“æœä¸­ï¼Œé‚£ä¹ˆå°†6379æ·»åŠ åˆ°å¼€æ”¾ç«¯å£åˆ—è¡¨ä¸­</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># firewall-cmd --permanent --add-port=6379/tcp</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># firewall-cmd --reload</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>centOS6<sup class="footnote-ref" id="fnref:v4"><a href="#fn:v4">4</a></sup></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># æ·»åŠ è§„åˆ™</span>
iptables -I INPUT -p tcp -m tcp --dport <span class="m">6379</span> -j ACCEPT
<span class="c1"># ä¿å­˜è§„åˆ™</span>
service iptables save
<span class="c1"># é‡å¯iptables</span>
service iptables restart</code></pre></td></tr></table>
</div>
</div>
<h2 id="2-3-é…ç½®æ–‡ä»¶redis-conf">2.3 é…ç½®æ–‡ä»¶redis.conf</h2>

<p>åœ¨redisçš„<a href="#section-1">å®‰è£…æ–‡ä»¶å¤¹</a>å†…ï¼Œæœ‰ä¸€ä¸ªç³»ç»Ÿé¢„é…ç½®æ–‡ä»¶<code>redis.conf</code>ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹æ­¤é…ç½®æ–‡ä»¶ä»¥æ»¡è¶³éœ€æ±‚ã€‚</p>

<p>ä»¥ä¸‹åˆ—å‡ºäº†(redis-standalone)å¸¸è§é…ç½®åˆ—è¡¨<sup class="footnote-ref" id="fnref:v4"><a href="#fn:v4">4</a></sup>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># redisè¿›ç¨‹æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼(åå°)è¿è¡Œ(ä¸ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œä¼šå ç”¨ä¸€ä¸ªç»ˆç«¯)</span>
daemonize yes
<span class="c1"># æŒ‡å®šredisè¿›ç¨‹çš„PIDæ–‡ä»¶å­˜æ”¾ä½ç½®</span>
pidfile /var/run/redis.pid
<span class="c1"># redisè¿›ç¨‹çš„ç«¯å£å·</span>
port <span class="m">6379</span>
<span class="c1"># å…è®¸ä»»ä½•ipv4çš„ä¸»æœºè¿æ¥ï¼›</span>
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
<span class="c1"># å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´(s)åå…³é—­è¿æ¥ï¼Œé»˜è®¤æ­¤å‚æ•°ä¸º0å³å…³é—­æ­¤åŠŸèƒ½</span>
timeout <span class="m">300</span>
<span class="c1"># redisæ—¥å¿—çº§åˆ«ï¼Œå¯ç”¨çš„çº§åˆ«æœ‰debug.verbose.notice.warning</span>
loglevel verbose
<span class="c1"># logæ–‡ä»¶è¾“å‡ºä½ç½®ï¼Œå¦‚æœè¿›ç¨‹ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œæ­¤å¤„åˆå°†è¾“å‡ºæ–‡ä»¶è®¾ç½®ä¸ºstdoutçš„è¯ï¼Œ</span>
<span class="c1"># å°±ä¼šå°†æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°/dev/nullé‡Œé¢å»äº†</span>
logfile /var/log/redis/redis_6379.log
<span class="c1"># è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤ä¸º0å¯ä»¥ä½¿ç”¨select &lt;dbid&gt;å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id</span>
databases <span class="m">16</span>
<span class="c1"># ä¿å­˜dbåˆ°ç£ç›˜ï¼Œå¯é…ç½®å¤šæ¡ï¼Œè¡¨ç¤ºä¸åŒçº§åˆ«çš„æ•°æ®æ”¹åŠ¨</span>
<span class="c1"># å¦‚ä¸‹é…ç½®è¡¨ç¤ºè‡³å°‘æœ‰ä¸€ä¸ªkey-valueå‘ç”Ÿæ”¹åŠ¨æ—¶ï¼Œ900sä¹‹åå°†å…¶ä¿å­˜åˆ°ç£ç›˜ï¼›</span>
<span class="c1"># å¦‚æœè‡³å°‘æœ‰10ä¸ªkey-valueå‘ç”Ÿæ”¹åŠ¨ï¼Œé‚£ä¹ˆ300såå°†å…¶ä¿å­˜åˆ°ç£ç›˜ï¼›</span>
save <span class="m">900</span> <span class="m">1</span>
save <span class="m">300</span> <span class="m">10</span>
<span class="c1"># æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºyeså³å¯ç”¨å­˜å‚¨</span>
rdbcompression yes
<span class="c1"># æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶å</span>
dbfilename dump.db
<span class="c1"># æŒ‡å®šæœ¬åœ°æ•°æ®æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œä»¥ä¸‹é…ç½®è¡¨ç¤ºä¿å­˜åœ¨rediså®‰è£…ç›®å½•</span>
dir ./
<span class="c1"># æŒ‡å®šå½“æœ¬æœºä¸ºslaveæœåŠ¡ï¼Œé…ç½®ä¸ºmasterçš„IPåŠç«¯å£ï¼Œåœ¨rediså¯åŠ¨çš„æ—¶å€™ä»–ä¼šè‡ªåŠ¨è·Ÿmasterè¿›è¡Œæ•°æ®åŒæ­¥</span>
slaveof &lt;masterip&gt; &lt;masterport&gt;
<span class="c1"># å½“masterè®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼ŒslaveæœåŠ¡è¿æ¥masterçš„å¯†ç </span>
masterauth &lt;master-password&gt;
<span class="c1"># è®¾ç½®redisè¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥redisæ˜¯éœ€è¦é€šè¿‡AUTH&lt;password&gt;å‘½ä»¤</span>
<span class="c1"># æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­</span>
requirepass password
<span class="c1"># è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ã€‚rediså¯ä»¥åŒæ—¶è¿æ¥çš„å®¢æˆ·ç«¯æ•°ä¸ºredisç¨‹åºå¯ä»¥æ‰“å¼€çš„æœ€å¤§</span>
<span class="c1"># æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœè®¾ç½® maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedisä¼šå…³é—­æ–°çš„</span>
<span class="c1"># è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å› max number of clients reached é”™è¯¯ä¿¡æ¯</span>
maxclients <span class="m">128</span>
<span class="c1"># æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedisä¼šå…ˆå°è¯•æ¸…é™¤</span>
<span class="c1"># å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„Keyã€‚å½“æ­¤æ–¹æ³•å¤„ç†åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥</span>
<span class="c1"># è¿›è¡Œè¯»å–æ“ä½œã€‚Redisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠKeyå­˜æ”¾å†…å­˜ï¼ŒValueä¼šå­˜æ”¾åœ¨swapåŒº</span>
maxmemory &lt;bytes&gt;
<span class="c1"># æŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedisåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯</span>
<span class="c1"># èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸ºredisæœ¬èº«åŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢saveæ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€ä»¥</span>
<span class="c1"># æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸ºnoã€‚</span>
appendonly no
<span class="c1"># æŒ‡å®šè·Ÿæ–°æ—¥å¿—æ–‡ä»¶åé»˜è®¤ä¸ºappendonly.aof</span>
appendfilename appendonly.aof
<span class="c1"># æŒ‡å®šæ›´æ–°æ—¥å¿—çš„æ¡ä»¶ï¼Œæœ‰ä¸‰ä¸ªå¯é€‰å‚æ•° - noï¼šè¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜(å¿«)ï¼Œalwaysï¼šè¡¨ç¤ºæ¯æ¬¡</span>
<span class="c1"># æ›´æ–°æ“ä½œåæ‰‹åŠ¨è°ƒç”¨fsync()å°†æ•°æ®å†™åˆ°ç£ç›˜(æ…¢ï¼Œå®‰å…¨)ï¼Œ everysecï¼šè¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€æ¬¡(æŠ˜è¡·ï¼Œé»˜è®¤å€¼)ï¼›</span>
appendfsync everysec</code></pre></td></tr></table>
</div>
</div>
<p>âš ï¸æ³¨æ„ï¼šå…³äº<code>bind</code>æŒ‡ä»¤çš„æè¿°<del>å¯ä»¥é…ç½®æŒ‡å®šipæ¥å…è®¸æŒ‡å®šè¿æ¥ï¼Œå¤šä¸ªipä½¿ç”¨ç©ºæ ¼åˆ†éš”</del>ï¼Œå…³äºbindçš„æ„ä¹‰ï¼Œå‚è€ƒ<a href="https://blog.csdn.net/hel12he/article/details/46911159">redisé…ç½®å¤–ç½‘è®¿é—®</a></p>

<h1 id="3-å¯åŠ¨redis">3 å¯åŠ¨redis</h1>

<p>redis.confæ–‡ä»¶é…ç½®æ— å·®çš„è¯ï¼Œå³å¯æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨redisæœåŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">redis-server /usr/local/redis/redis.conf</code></pre></td></tr></table>
</div>
</div>
<p>å¯åŠ¨æ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></pre></td>
<td class="lntd">
<pre class="chroma">27552:C 04 Aug 16:12:58.912 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
27552:C 04 Aug 16:12:58.912 # Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=27552, just started
27552:C 04 Aug 16:12:58.912 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
 |    `-._   `._    /     _.-&#39;    |     PID: 27553
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                           
              `-.__.-&#39;                                               

27553:M 04 Aug 16:12:58.915 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
27553:M 04 Aug 16:12:58.916 # Server initialized
27553:M 04 Aug 16:12:58.916 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.
27553:M 04 Aug 16:12:58.916 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
27553:M 04 Aug 16:12:58.916 * Ready to accept connections</pre></td></tr></table>
</div>
</div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ª<code>standalon</code>å·²ç»è¿è¡ŒæˆåŠŸï¼Œä½†æ˜¯æœ‰3ä¸ªWARNING<sup class="footnote-ref" id="fnref:v5"><a href="#fn:v5">5</a></sup>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">WARNING: The TCP backlog setting of <span class="m">511</span> cannot be enforced because /proc/sys/net/core/somaxconn is <span class="nb">set</span> to the lower value of <span class="m">128</span>.
<span class="c1"># solution</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># echo 511 &gt;/proc/sys/net/core/somaxconn</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># echo &#34;net.core.somaxconn = 551&#34; &gt;&gt; /etc/sysctl.conf</span>

WARNING overcommit_memory is <span class="nb">set</span> to <span class="m">0</span>! Background save may fail under low memory condition. To fix this issue add <span class="s1">&#39;vm.overcommit_memory = 1&#39;</span> to /etc/sysctl.conf and <span class="k">then</span> reboot or run the <span class="nb">command</span> <span class="s1">&#39;sysctl vm.overcommit_memory=1&#39;</span> <span class="k">for</span> this to take effect.
<span class="c1">#solution</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># echo 1 &gt; /proc/sys/vm/overcommit_memory</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># echo &#34;vm.overcommit_memory=1&#34; &gt;&gt; /etc/sysctl.conf</span>

WARNING you have Transparent Huge Pages <span class="o">(</span>THP<span class="o">)</span> support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the <span class="nb">command</span> <span class="s1">&#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39;</span> as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.
<span class="c1">#solution</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span>
<span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># vi /etc/rc.local</span>
<span class="k">if</span> <span class="nb">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled<span class="p">;</span> <span class="k">then</span>
   <span class="nb">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled
<span class="k">fi</span>
<span class="k">if</span> <span class="nb">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag<span class="p">;</span> <span class="k">then</span>
   <span class="nb">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag
<span class="k">fi</span>    </code></pre></td></tr></table>
</div>
</div>
<h1 id="4-ä½¿ç”¨redis-cli">4 ä½¿ç”¨redis-cli</h1>

<p>redisæœåŠ¡å¯åŠ¨æˆåŠŸä¹‹åï¼Œä¾¿å¯ä»¥é€šè¿‡<code>redis-cli</code>ä¸æœåŠ¡è¿›è¡Œäº¤äº’ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># è¿æ¥redis-serverï¼Œè‹¥-hå’Œ-på‚æ•°ç¼ºçœï¼Œåˆ™é»˜è®¤è¿æ¥localhost:6379</span>
redis-cli -h <span class="m">127</span>.0.0.1 -p <span class="m">6379</span>
<span class="m">127</span>.0.0.1:6379&gt;
<span class="c1"># è‹¥redis-server requirepassè®¾ç½®äº†å¯†ç ï¼Œé‚£ä¹ˆéœ€è¦è®¤è¯</span>
<span class="m">127</span>.0.0.1:6379&gt; auth yourpassword
OK
<span class="c1"># ping-PONGè¯´æ˜redisæœåŠ¡æ­£å¸¸</span>
<span class="m">127</span>.0.0.1:6379&gt; ping
<span class="m">127</span>.0.0.1:6379&gt; PONG
<span class="c1"># è·å–å¸®åŠ©</span>
<span class="m">127</span>.0.0.1:6379&gt; <span class="nb">help</span>
redis-cli <span class="m">4</span>.0.11
To get <span class="nb">help</span> about Redis commands type:
      <span class="s2">&#34;help @&lt;group&gt;&#34;</span> to get a list of commands in &lt;group&gt;
      <span class="s2">&#34;help &lt;command&gt;&#34;</span> <span class="k">for</span> <span class="nb">help</span> on &lt;command&gt;
      <span class="s2">&#34;help &lt;tab&gt;&#34;</span> to get a list of possible <span class="nb">help</span> topics
      <span class="s2">&#34;quit&#34;</span> to <span class="nb">exit</span>

To <span class="nb">set</span> redis-cli preferences:
      <span class="s2">&#34;:set hints&#34;</span> <span class="nb">enable</span> online hints
      <span class="s2">&#34;:set nohints&#34;</span> disable online hints
Set your preferences in ~/.redisclirc
<span class="m">127</span>.0.0.1:6379&gt; <span class="nb">help</span> shutdown

  SHUTDOWN <span class="o">[</span>NOSAVE<span class="p">|</span>SAVE<span class="o">]</span>
  summary: Synchronously save the dataset to disk and <span class="k">then</span> shut down the server
  since: <span class="m">1</span>.0.0
  group: server

<span class="m">127</span>.0.0.1:6379&gt;
<span class="c1"># é€€å‡ºå®¢æˆ·ç«¯</span>
<span class="m">127</span>.0.0.1:6379&gt; exit</code></pre></td></tr></table>
</div>
</div>
<h1 id="5-å…³é—­redis-server">5 å…³é—­redis-server</h1>

<div class="admonition warning"><p class="admonition-title">warning</p>
  ä¸è¦ä½¿ç”¨kill -9 pidå…³é—­redis serverï¼Œè¿™æ ·ä¼šå¯èƒ½ä¼šä¸¢å¤±æ•°æ®å®Œæ•´æ€§ 
</div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#å…³é—­redis-server å¯é€‰å‚æ•°nosave|saveæ„ä¸ºå…³é—­æœåŠ¡ä¹‹å‰æ˜¯å¦ä¿å­˜æ•°æ®åˆ°ç£ç›˜</span>
<span class="m">127</span>.0.0.1:6379&gt; shutdown <span class="o">[</span>nosave<span class="p">|</span>save<span class="o">]</span></code></pre></td></tr></table>
</div>
</div>
<h1 id="6-è‰ºæœ¯å°±æ˜¯å¤åˆ¶">6 è‰ºæœ¯å°±æ˜¯å¤åˆ¶</h1>

<div class="admonition danger"><p class="admonition-title">danger</p>
  ä»¥ä¸‹é…ç½®æ˜¯åŸºäºä¸€å°æœåŠ¡å™¨çš„æ¼”ç¤ºï¼Œå¦‚æœè¦éƒ¨ç½²é«˜å¯ç”¨ç¯å¢ƒï¼Œéœ€è¦åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šå®‰è£…rediså¹¶ä½œå¦‚ä¸‹é…ç½®
</div>

<p>ç»è¿‡ä¸Šè¿°æ“ä½œï¼Œä¸€ä¸ªredis-standaloneæœåŠ¡å°±é…ç½®å¥½äº†ï¼Œå¦‚æœè¦å°†redisç³»ç»Ÿé«˜å¯ç”¨ï¼Œåªéœ€è¦ã€Œå¤åˆ¶ã€å°±å¥½äº†ã€‚</p>

<p>å‰é¢è¯´è¿‡ï¼Œ<code>redis-server</code>æ˜¯é€šè¿‡<strong>å¯æ‰§è¡Œæ–‡ä»¶ + é…ç½®æ–‡ä»¶</strong>çš„æ–¹å¼å¯åŠ¨ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å·²ç»è§£å‹å¾—åˆ°ï¼Œé‚£ä¹ˆåªéœ€è¦å¤åˆ¶é…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p>

<p>ä»¥ä¸‹æ˜¯æœ¬æ¬¡slaveå’Œsentinelçš„é…ç½®ï¼š</p>

<table>
<thead>
<tr>
<th>Role</th>
<th align="center">Address</th>
<th align="left">Port</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>Master</strong></td>
<td align="center">localhost</td>
<td align="left">6379</td>
</tr>

<tr>
<td>Slave</td>
<td align="center">localhost</td>
<td align="left">16379, 26379</td>
</tr>

<tr>
<td>Sentinel</td>
<td align="center">localhost</td>
<td align="left">6380, 16380, 26380</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># current workDir</span>
<span class="nb">cd</span> /usr/local
<span class="c1"># åˆ›å»ºæ–‡ä»¶å¤¹å­˜æ”¾slaveå’Œsentinelé…ç½®æ–‡ä»¶</span>
mkdir redis-slave  redis-sentinel
cp -r redis/redis.conf redis-slave
cp -r redis/redis.conf redis-sentinel
<span class="c1"># slaveé…ç½®æ–‡ä»¶</span>
mv redis-slave/redis.conf redis-slave/slave-16379.conf</code></pre></td></tr></table>
</div>
</div>
<h2 id="6-1-é…ç½®redis-salve">6.1 é…ç½®redis-salve</h2>

<p>slaveçš„é…ç½®å¤§æŠµå’Œstandaloneä¸€è‡´ï¼Œéœ€è¦æ³¨æ„é…ç½®å‡ ä¸ªåœ°æ–¹ï¼š</p>

<ul>
<li><code>logfile</code>çš„ä¿å­˜åœ°å€é…ç½®è‡ªè¡Œé…ç½®</li>
<li><code>masterauth</code>å’Œ<code>requirepass</code>é…ç½®masterçš„å¯†ç </li>
<li><code>slaveof</code>æŒ‡æ˜äº†å…¶æ˜¯å“ªä¸ªã€Œä¸»ã€çš„ã€Œä»ã€</li>
<li><code>slave-read-only</code>æŒ‡æ˜ä»æœåŠ¡å™¨åªè¯»</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">vim redis-slave/slave-16379.conf
<span class="o">&lt;&lt;&lt;</span>
    daemonize yes
    pidfile /var/run/redis-16379.pid
    logfile /var/log/redis/redis-16379.log
    port <span class="m">16379</span>
    <span class="nb">bind</span> <span class="m">0</span>.0.0.0
    timeout <span class="m">300</span>
    databases <span class="m">16</span>
    dbfilename dump-16379.db
    dir ./
    masterauth yourpassword
    requirepass yourpassword
    slave-read-only yes
    slaveof <span class="m">127</span>.0.0.1 <span class="m">6379</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># å†å¤šé…ä¸€ä¸ªslave</span>
cp redis-slave/slave-16379.conf redis-slave/slave-26379.conf</code></pre></td></tr></table>
</div>
</div>
<p>åŒæ ·åœ°ï¼Œåªéœ€è¦æ›´æ”¹éƒ¨åˆ†é…ç½®å†…å®¹ï¼ˆç«¯å£ï¼Œæ–‡ä»¶åï¼‰å°±å¯ä»¥äº†ã€‚</p>

<h3 id="6-1-1-salveå¯åŠ¨æ—¥å¿—">6.1.1 salveå¯åŠ¨æ—¥å¿—</h3>

<p>ä»¥ä¸‹æ˜¯é…ç½®æˆåŠŸçš„slaveå¯åŠ¨æ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></pre></td>
<td class="lntd">
<pre class="chroma">30463:C 05 Aug 11:33:34.536 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
30463:C 05 Aug 11:33:34.537 # Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=30463, just started
30463:C 05 Aug 11:33:34.537 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 26379
 |    `-._   `._    /     _.-&#39;    |     PID: 30464
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                      
              `-.__.-&#39;                                               

30464:S 05 Aug 11:33:34.539 # Server initialized
30464:S 05 Aug 11:33:34.539 * Ready to accept connections
# æ³¨æ„ä»¥ä¸‹è¾“å‡ºï¼š
30464:S 05 Aug 11:33:34.539 * Connecting to MASTER 127.0.0.1:6379
30464:S 05 Aug 11:33:34.539 * MASTER &lt;-&gt; SLAVE sync started
30464:S 05 Aug 11:33:34.539 * Non blocking connect for SYNC fired the event.
30464:S 05 Aug 11:33:34.539 * Master replied to PING, replication can continue...
30464:S 05 Aug 11:33:34.539 * Partial resynchronization not possible (no cached master)
30464:S 05 Aug 11:33:34.540 * Full resync from master: 4e99dfc708f2035b3b39f34796434de5889f667b:308
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: receiving 177 bytes from master
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Flushing old data
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Loading DB in memory
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Finished with success</pre></td></tr></table>
</div>
</div>
<p>slaveçš„å¯åŠ¨æ—¥å¿—æœ‰å‡ ä¸ªä¿¡æ¯å€¼å¾—å…³æ³¨ï¼š</p>

<ul>
<li>rediså¯åŠ¨è­¦å‘Šä¿¡æ¯æ¶ˆé™¤ï¼Œè¯´æ˜æˆ‘ä»¬ä¹‹å‰çš„é…ç½®ç”Ÿæ•ˆäº†ï¼›</li>
<li>slave server åˆå§‹åŒ–æˆåŠŸä¹‹åï¼Œä¾¿å¼€å§‹è¿æ¥masterï¼›</li>
<li>master è¿æ¥æˆåŠŸä¹‹åï¼Œä¾¿å¼€å§‹ä»ä¸»æ•°æ®åº“åŒæ­¥æ•°æ®ï¼›</li>
<li>ä¹‹åï¼Œä»æ•°æ®åº“ä¸€ç›´ç›‘å¬<sup><a>æœºåˆ¶</a></sup>ä¸»æ•°æ®åº“çš„æ”¹åŠ¨å¹¶åŒæ­¥æ•°æ®</li>
</ul>

<h3 id="6-1-2-éªŒè¯ä¸»ä»æ•°æ®åŒæ­¥">6.1.2 éªŒè¯ä¸»ä»æ•°æ®åŒæ­¥</h3>

<p>å¯ä»¥é€šè¿‡åœ¨ä¸»æ•°æ®åº“å†™å…¥æ•°æ®ï¼Œé€šè¿‡ä»æœåŠ¡å™¨è¯»å–æ•°æ®æ¥éªŒè¯ä¸»ä»å…³ç³»æ˜¯å¦æ­£å¸¸ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">[</span>root@shell ~<span class="o">]</span><span class="c1"># redis-cli -h localhost -p 6379</span>
localhost:6379&gt; auth yourpassword
OK
localhost:16379&gt; get count
<span class="s2">&#34;6&#34;</span>
localhost:16379&gt; decr count
<span class="o">(</span>integer<span class="o">)</span> <span class="m">5</span>
localhost:16379&gt; <span class="nb">exit</span>
<span class="o">[</span>root@ ~<span class="o">]</span><span class="c1"># redis-cli -h localhost -p 16379</span>
localhost:6379&gt; auth yourpassword
OK
localhost:6379&gt; get count
<span class="s2">&#34;5&#34;</span>
localhost:6379&gt; incr count
<span class="o">(</span>error<span class="o">)</span> READONLY You can<span class="err">&#39;</span>t write against a <span class="nb">read</span> only slave.</code></pre></td></tr></table>
</div>
</div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»æœåŠ¡å™¨å°†countå€¼è‡ªå‡1ä¹‹åï¼Œä»æœåŠ¡å™¨è·å–çš„countå€¼ä¹Ÿæ˜¯è‡ªå‡åçš„å€¼ï¼›åŒæ—¶ï¼Œå¦‚æœåœ¨ä»æœåŠ¡å™¨ä¸Šå¯¹countè¿›è¡Œè‡ªå¢æ“ä½œï¼Œä¼šå¾—åˆ°ä¸€æ¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">(error) READONLY You can&#39;t write against a read only slave.</pre></td></tr></table>
</div>
</div>
<p>çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯´æ˜</p>

<ul>
<li><p>ç«¯å£16379çš„redisæœåŠ¡æ˜¯slaveï¼›</p></li>

<li><p>æˆ‘ä»¬é…ç½®çš„ä»æœåŠ¡å™¨åªè¯»ç”Ÿæ•ˆäº†</p></li>
</ul>

<p>ä»¥ä¸Šï¼Œå³å¯å®Œæˆé…ç½®ç»å…¸çš„ä¸€ä¸»å¤šå¤‡çš„redisæœåŠ¡éƒ¨ç½²ã€‚</p>

<h2 id="6-2-é…ç½®redis-sentinel">6.2 é…ç½®redis-sentinel</h2>

<p>åŒ<code>slave</code>çš„é…ç½®ä¸€æ ·ï¼Œå¤åˆ¶é…ç½®æ–‡ä»¶ï¼Œå°‘è®¸æ”¹åŠ¨å³å¯ï¼Œä»¥ä¸‹åˆ—å‡ºäº†<code>sentinel</code>çš„å¼‚äº<code>slave</code>çš„é…ç½®é¡¹<sup class="footnote-ref" id="fnref:v7"><a href="#fn:v7">6</a></sup>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># å“¨å…µsentinelç›‘æ§çš„redisä¸»èŠ‚ç‚¹çš„</span>
<span class="c1">## quorumï¼šå½“è¿™äº›quorumä¸ªæ•°sentinelå“¨å…µè®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶ å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº†</span>  
<span class="c1"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;</span>  
sentinel monitor master <span class="m">127</span>.0.0.1 <span class="m">6379</span> <span class="m">2</span>

<span class="c1"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass &lt;foobared&gt;ï¼Œæ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç </span>
<span class="c1"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span>  
sentinel auth-pass master yourpassword  

<span class="c1"># æŒ‡å®šä¸»èŠ‚ç‚¹åº”ç­”å“¨å…µsentinelçš„æœ€å¤§æ—¶é—´é—´éš”ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œé»˜è®¤30ç§’</span>  
<span class="c1"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span>
sentinel down-after-milliseconds master <span class="m">30000</span>  

<span class="c1"># æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ã€‚è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼›åä¹‹ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º1ï¼Œæ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslaveï¼Œå¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚</span>
<span class="c1"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span>
sentinel parallel-syncs master <span class="m">1</span>  

<span class="c1"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´failover-timeoutï¼Œé»˜è®¤ä¸‰åˆ†é’Ÿï¼Œå¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š</span>
<span class="c1">## 1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚</span>  
<span class="c1">## 2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶å¼€å§‹ï¼Œç›´åˆ°slaveè¢«çº æ­£ä¸ºä»æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ç»“æŸã€‚</span>  
<span class="c1">## 3. å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ—¶æ‰€éœ€è¦çš„æ—¶é—´ã€‚</span>
<span class="c1">## 4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥åŒæ­¥æ•°æ®äº†</span>
<span class="c1"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span>  
sentinel failover-timeout master <span class="m">180000</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># sentinelé…ç½®æ–‡ä»¶</span>
mv redis-sentinel/redis.conf redis-sentinel/sentinel-6380.conf
vim redis-sentinel/sentinel-6380.conf
<span class="o">&lt;&lt;&lt;</span>
protected-mode no
<span class="nb">bind</span> <span class="m">0</span>.0.0.0
port <span class="m">16380</span>
daemonize yes
sentinel monitor master <span class="m">127</span>.0.0.1 <span class="m">6379</span> <span class="m">2</span>
sentinel down-after-milliseconds master <span class="m">5000</span>
sentinel failover-timeout master <span class="m">180000</span>
sentinel parallel-syncs master <span class="m">1</span>
sentinel auth-pass master yourpassword
logfile /var/log/redis/sentinel-16380.log</code></pre></td></tr></table>
</div>
</div>
<p>åŒç†ï¼Œå¯ä»¥å†é…ç½®å…¶ä»–2ä¸ª<code>sentinel</code>æœåŠ¡ã€‚</p>

<h3 id="6-2-1-sentinelå¯åŠ¨æ—¥å¿—">6.2.1 sentinelå¯åŠ¨æ—¥å¿—</h3>

<p>å¯åŠ¨sentinel<sup class="footnote-ref" id="fnref:v8"><a href="#fn:v8">7</a></sup></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell">redis-sentinel /usr/local/redis-sentinel/sentinel-6380.conf
<span class="c1"># æˆ–è€…</span>
redis-server /usr/local/redis-sentinel/sentinel-6380.conf --sentinel</code></pre></td></tr></table>
</div>
</div>
<p>ä»¥ä¸‹æ˜¯é…ç½®æˆåŠŸçš„<code>sentinel</code>å¯åŠ¨æ—¥å¿—å…¶ä¸€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></pre></td>
<td class="lntd">
<pre class="chroma">8550:X 05 Aug 14:29:38.696 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
8550:X 05 Aug 14:29:38.696 # Redis version=4.0.11, bits=64, commit=00000000, modified=0, pid=8550, just started
8550:X 05 Aug 14:29:38.696 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in sentinel mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6380
 |    `-._   `._    /     _.-&#39;    |     PID: 8551
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                           
              `-.__.-&#39;                                               

8551:X 05 Aug 14:29:38.702 # Sentinel ID is c3776869c9bc3998e45158d3933d8e7b7c60ea84
8551:X 05 Aug 14:29:38.702 # +monitor master master 127.0.0.1 6379 quorum 2</pre></td></tr></table>
</div>
</div>
<p>é€šè¿‡è§‚æŸ¥å¯åŠ¨æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>

<ul>
<li>æ­¤å®ä¾‹çš„å¯åŠ¨æ¨¡å¼ä¸º<code>sentinel mode</code>ï¼Œç«¯å£ä¸º6380</li>
<li><code>sentinel</code>å·²ç»æˆåŠŸç›‘æ§<code>master</code>ç«¯å£6379äº†</li>
</ul>

<p>å…¨éƒ¨å“¨å…µç³»ç»Ÿæ­å»ºèµ·æ¥å¹¶è¿è¡Œä¹‹åï¼Œå†å»æŸ¥çœ‹<code>sentinel</code>çš„é…ç½®æ–‡ä»¶ï¼Œä¼šæœ‰å¦‚ä¸‹è‡ªåŠ¨é…ç½®çš„å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></pre></td>
<td class="lntd">
<pre class="chroma"># Generated by CONFIG REWRITE
sentinel auth-pass master yourpassword
sentinel config-epoch master 1
sentinel leader-epoch master 1
sentinel known-slave master 127.0.0.1 16379
sentinel known-slave master 127.0.0.1 26379
sentinel known-sentinel master 127.0.0.1 26380 e615ce0f9e12531b83b3c7c7ff0e91e3c8873222
sentinel known-sentinel master 127.0.0.1 6380 dcc9d7e345a7f4db3b304b032bd1b41a8a7fc706
sentinel current-epoch 1</pre></td></tr></table>
</div>
</div>
<p>ä¸Šé¢çš„é…ç½®åˆ—å‡ºäº†</p>

<ul>
<li>ä¸»æœåŠ¡å™¨çš„å¯†ç </li>
<li>ä»¥åŠå½“å‰ä¸–ä»£ï¼ˆæ¯å‘ç”Ÿä¸€æ¬¡ä¸»å¤‡åˆ‡æ¢ç§°ä¸ºä¸€æ¬¡ä¸–ä»£ï¼ŒepochåŠ 1ï¼‰</li>
<li>å½“å‰æ‰€æœ‰ä»æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ä¿¡æ¯</li>
<li>å½“å‰æ‰€ä»¥å…¶ä»–å·²çŸ¥å“¨å…µçš„ç«¯å£å’Œidä¿¡æ¯</li>
</ul>

<h3 id="6-2-2-ä½¿ç”¨redis-cliæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯">6.2.2 ä½¿ç”¨redis-cliæŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</h3>

<p><code>sentinel</code>å“¨å…µç³»ç»Ÿæ­å»ºèµ·æ¥ä¹‹åï¼Œå¯ä»¥ä»»ä¸€é€šè¿‡å®¢æˆ·ç«¯æŸ¥çœ‹ç³»ç»Ÿå†…çš„å®ä¾‹ä¿¡æ¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="m">127</span>.0.0.1:16380&gt; sentinel master master
 <span class="m">1</span><span class="o">)</span> <span class="s2">&#34;name&#34;</span>
 <span class="m">2</span><span class="o">)</span> <span class="s2">&#34;master&#34;</span>
 <span class="m">3</span><span class="o">)</span> <span class="s2">&#34;ip&#34;</span>
 <span class="m">4</span><span class="o">)</span> <span class="s2">&#34;127.0.0.1&#34;</span>
 <span class="m">5</span><span class="o">)</span> <span class="s2">&#34;port&#34;</span>
 <span class="m">6</span><span class="o">)</span> <span class="s2">&#34;6379&#34;</span>
 <span class="m">7</span><span class="o">)</span> <span class="s2">&#34;runid&#34;</span>
 <span class="m">8</span><span class="o">)</span> <span class="s2">&#34;dfefe0ba7435f7c2c193698f17b7e46f7450d5ce&#34;</span>
 <span class="m">9</span><span class="o">)</span> <span class="s2">&#34;flags&#34;</span>
<span class="m">10</span><span class="o">)</span> <span class="s2">&#34;master&#34;</span>
...
<span class="m">127</span>.0.0.1:16380&gt; sentinel slaves master
<span class="m">1</span><span class="o">)</span>  <span class="m">1</span><span class="o">)</span> <span class="s2">&#34;name&#34;</span>
    <span class="m">2</span><span class="o">)</span> <span class="s2">&#34;127.0.0.1:16379&#34;</span>
    <span class="m">3</span><span class="o">)</span> <span class="s2">&#34;ip&#34;</span>
    <span class="m">4</span><span class="o">)</span> <span class="s2">&#34;127.0.0.1&#34;</span>
    <span class="m">5</span><span class="o">)</span> <span class="s2">&#34;port&#34;</span>
    <span class="m">6</span><span class="o">)</span> <span class="s2">&#34;16379&#34;</span>
    <span class="m">7</span><span class="o">)</span> <span class="s2">&#34;runid&#34;</span>
    <span class="m">8</span><span class="o">)</span> <span class="s2">&#34;fdda882f98724c46359a4deb9390b6ae4de13320&#34;</span>
    <span class="m">9</span><span class="o">)</span> <span class="s2">&#34;flags&#34;</span>
   <span class="m">10</span><span class="o">)</span> <span class="s2">&#34;slave&#34;</span>
 ...
<span class="m">2</span><span class="o">)</span>  <span class="m">1</span><span class="o">)</span> <span class="s2">&#34;name&#34;</span>
    <span class="m">2</span><span class="o">)</span> <span class="s2">&#34;127.0.0.1:26379&#34;</span>
    <span class="m">3</span><span class="o">)</span> <span class="s2">&#34;ip&#34;</span>
    <span class="m">4</span><span class="o">)</span> <span class="s2">&#34;127.0.0.1&#34;</span>
    <span class="m">5</span><span class="o">)</span> <span class="s2">&#34;port&#34;</span>
    <span class="m">6</span><span class="o">)</span> <span class="s2">&#34;26379&#34;</span>
    <span class="m">7</span><span class="o">)</span> <span class="s2">&#34;runid&#34;</span>
    <span class="m">8</span><span class="o">)</span> <span class="s2">&#34;4a2c286c0c99c3a1202eec142599193a85671f6c&#34;</span>
    <span class="m">9</span><span class="o">)</span> <span class="s2">&#34;flags&#34;</span>
   <span class="m">10</span><span class="o">)</span> <span class="s2">&#34;slave&#34;</span>
...</code></pre></td></tr></table>
</div>
</div>
<h3 id="6-2-3-æ¨¡æ‹Ÿä¸»å¤‡åˆ‡æ¢">6.2.3 æ¨¡æ‹Ÿä¸»å¤‡åˆ‡æ¢</h3>

<p>å“¨å…µçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³<code>master-slave</code>ç³»ç»Ÿä¸­ç”±äº<code>master</code>å®•æœºå¼•èµ·çš„ç³»ç»Ÿç˜«ç—ªé—®é¢˜ã€‚</p>

<p>åœ¨å“¨å…µç³»ç»Ÿä¸­ï¼Œä¸€æ—¦å“¨å…µå‘ç°å½“å‰<code>master</code>å®•æœºï¼Œå“¨å…µä¼šåœ¨ä½™ä¸‹çš„<code>slaves</code>ä¸­é€‰ä¸¾ä¸€ä¸ªã€Œç»§ä»»ã€ä¸ºæ–°ä¸€ä»£çš„<code>master</code>ï¼Œä»è€Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸»åŠ¨å…³é—­å½“å‰<code>master</code>æœåŠ¡çš„æ–¹å¼æ¥æ¨¡æ‹Ÿ<code>master</code>å®•æœºï¼Œçœ‹çœ‹å“¨å…µä¼šåšä»€ä¹ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Shell" data-lang="Shell"><span class="c1"># å…³é—­masteræœåŠ¡</span>
redis-cli -p <span class="m">6379</span>
<span class="m">127</span>.0.0.1:6379&gt; auth yourpassword
OK
<span class="m">127</span>.0.0.1:6379&gt; shutdown save
<span class="m">127</span>.0.0.1:6379&gt; <span class="nb">exit</span>
<span class="c1"># æŸ¥çœ‹sentinelæ—¥å¿—</span>
less /var/log/redis/sentinel-6380.log
<span class="o">&lt;&lt;&lt;</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:02.326 <span class="c1"># +sdown master master 127.0.0.1 6379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:02.389 <span class="c1"># +new-epoch 1</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:02.391 <span class="c1"># +vote-for-leader 503d5371452f8e110df0f12c236da3e51b55b03a 1</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.444 <span class="c1"># +odown master master 127.0.0.1 6379 #quorum 3/2</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.444 <span class="c1"># Next failover delay: I will not start a failover before Fri Aug 23 17:14:38 2019</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.488 <span class="c1"># +config-update-from sentinel 503d5371452f8e110df0f12c236da3e51b55b03a 172.16.16.203 16380 @ master 127.0.0.1 6379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.488 <span class="c1"># +switch-master master 127.0.0.1 6379 127.0.0.1 26379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.488 * +slave slave <span class="m">127</span>.0.0.1:16379 <span class="m">127</span>.0.0.1 <span class="m">16379</span> @ master <span class="m">127</span>.0.0.1 <span class="m">26379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:03.488 * +slave slave <span class="m">127</span>.0.0.1:6379 <span class="m">127</span>.0.0.1 <span class="m">6379</span> @ master <span class="m">127</span>.0.0.1 <span class="m">26379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:14:08.536 <span class="c1"># +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ master 127.0.0.1 26379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:15:42.868 <span class="c1"># -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ master 127.0.0.1 26379</span>
<span class="m">29649</span>:X <span class="m">23</span> Aug <span class="m">17</span>:15:52.888 * +convert-to-slave slave <span class="m">127</span>.0.0.1:6379 <span class="m">127</span>.0.0.1 <span class="m">6379</span> @ master <span class="m">127</span>.0.0.1 <span class="m">26379</span></code></pre></td></tr></table>
</div>
</div>
<p>é€šè¿‡24è¡Œ<code>sentinel</code>æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„ä¿¡æ¯æœ‰å“ªäº›å‘¢ï¼Ÿ</p>

<ul>
<li>master<strong>ä¸»è§‚ä¸‹çº¿</strong><sup class="footnote-ref" id="fnref:v9"><a href="#fn:v9">8</a></sup>ï¼›</li>
<li>ç³»ç»Ÿè¿›å…¥æ–°ä¸–ä»£ï¼›</li>
<li>3/2æŠ•ç¥¨è®¤ä¸ºmasterä¸‹çº¿ï¼Œmaster<strong>å®¢è§‚ä¸‹çº¿</strong><sup class="footnote-ref" id="fnref:v10"><a href="#fn:v10">9</a></sup>ï¼›</li>
<li>åˆ‡æ¢ä¸»æœåŠ¡å™¨ï¼šä»6379åˆ‡æ¢ä¸º26379ï¼›</li>
<li>åŒæ—¶6379å’Œ16379åˆ‡æ¢ä¸º26379çš„ä»èŠ‚ç‚¹</li>
</ul>

<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¦‚æœæŸ¥çœ‹redisçš„é…ç½®æ–‡ä»¶ï¼Œä¼šå‘ç°åŸ<code>6379</code>çš„ä¸»æœåŠ¡å™¨é…ç½®æ–‡ä»¶å¤šäº†ä¸€è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">slaveof 127.0.0.1 26379</pre></td></tr></table>
</div>
</div>
<p>åŒæ—¶ï¼Œ<code>16379</code>å’Œ<code>26379</code>ç«¯å£çš„æœåŠ¡çš„<code>slaveof</code>é…ç½®é¡¹ä¹Ÿä½œäº†ç›¸åº”ä¿®æ”¹ã€‚</p>

<h1 id="7-ç»“æŸè¯­">7 ç»“æŸè¯­</h1>

<p>è‡³æ­¤ï¼ŒåŸºäº<code>sentinel</code>çš„redisé«˜å¯ç”¨é›†ç¾¤å°±æ­å»ºå®Œæˆäº†ã€‚è™½ç„¶ç¯‡å¹…è¾ƒé•¿ï¼Œå®é™…ä¸Šæ­å»ºä¸€ä¸ªè¿™æ ·çš„ç³»ç»Ÿçš„é€»è¾‘æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>

<p>ä¸»è¦æ˜“äºæ··æ·†çš„æ˜¯6ä¸ä¸ªrediså®ä¾‹çš„é…ç½®ï¼Œç»†å¿ƒç‚¹å°±å¥½äº†ã€‚</p>

<p>æƒ³ç”¨å¥½è¿™ä¸ªé«˜å¯ç”¨ç³»ç»Ÿï¼Œä½ å¯èƒ½è¿˜éœ€è¦äº†è§£æ›´å¤šå…³äº<code>sentinel</code>çš„å†…å®¹ã€‚</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:v1">æœ¬æ–‡æ˜¯åœ¨æ‰€æœ‰æœåŠ¡å‡é…ç½®å®Œæˆä¹‹åæ‰€ä½œçš„è®°å½•ï¼Œå¹¶éåŒæ­¥è®°å½•ï¼Œéƒ¨åˆ†æ“ä½œå¯èƒ½å­˜åœ¨é”™è¯¯
 <a class="footnote-return" href="#fnref:v1"><sup>[return]</sup></a></li>
<li id="fn:v2">ä¸‹æ–‡ä¼šå¤šæ¬¡æåˆ°å®ä¾‹è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒåœ¨æœ¬æ–‡ä¸­æŒ‡ä¸€ä¸ªè¿è¡Œçš„Redisæ•°æ®åº“æœåŠ¡
 <a class="footnote-return" href="#fnref:v2"><sup>[return]</sup></a></li>
<li id="fn:v3">ç›‘æ§masterçŠ¶æ€ï¼Œå¦‚æœå®•æœºï¼Œåˆ™æ‰§è¡Œä¸»å¤‡åˆ‡æ¢
 <a class="footnote-return" href="#fnref:v3"><sup>[return]</sup></a></li>
<li id="fn:v4"><a href="https://juejin.im/post/5b76e732f265da4376203849#heading-11">æ­å»ºrediså•æœºæœåŠ¡</a>
 <a class="footnote-return" href="#fnref:v4"><sup>[return]</sup></a></li>
<li id="fn:v5"><a href="https://blog.csdn.net/kk185800961/article/details/53326465">è§£å†³rediså¯åŠ¨çš„3ä¸ªè­¦å‘Š</a>
 <a class="footnote-return" href="#fnref:v5"><sup>[return]</sup></a></li>
<li id="fn:v7"><a href="https://juejin.im/post/5b7d226a6fb9a01a1e01ff64">rediså“¨å…µä¸é«˜å¯ç”¨</a>
 <a class="footnote-return" href="#fnref:v7"><sup>[return]</sup></a></li>
<li id="fn:v8"><a href="https://www.mankier.com/1/redis-server">redis-server man page</a>
 <a class="footnote-return" href="#fnref:v8"><sup>[return]</sup></a></li>
<li id="fn:v9">ä»…å½“å‰å“¨å…µæ¥æ”¶ä¸åˆ°masterçš„å¿ƒè·³ï¼Œç§°ä¸ºä¸»è§‚ä¸‹çº¿
 <a class="footnote-return" href="#fnref:v9"><sup>[return]</sup></a></li>
<li id="fn:v10">ç»è¿‡æŠ•ç¥¨ä¹‹åï¼Œæ»¡è¶³é…ç½®ä¸ªæ•°çš„å“¨å…µè®¤ä¸ºmasterä¸‹çº¿ï¼Œåˆ™masterè¢«è®¤ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œè§¦å‘ä¸»å¤‡åˆ‡æ¢
 <a class="footnote-return" href="#fnref:v10"><sup>[return]</sup></a></li>
</ol>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">wangy325</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2020-11-20
        <a href="https://github.com/wangy325/endlessriver/commit/9a09a7ba130782d0b5d849fa7111a5a313f2c141" title="add concurrent tools, change doc directorys, and other file format change.">(9a09a7b)</a>
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/redis/">redis</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/tech/%E8%87%AA%E5%BB%BAmysql/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">è‡ªå»ºmysqlæ•°æ®åº“</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/tech/java-script%E4%B8%AD%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/">
            <span class="next-text nav-default">Java Scriptä¸­çš„æ„é€ å‡½æ•°</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'endlessriver';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=u8za1dzCiImO_8rKldjU1g" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/wangy325" class="iconfont icon-github" title="github"></a>
  <a href="https://wangy325.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    
    
  </div>

  <span class="copyright-year">
    &copy; 
    2019 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">wangy325</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
